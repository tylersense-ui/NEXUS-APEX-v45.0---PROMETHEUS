/**
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
 * â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 * â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
 *                           v45.0 - "Stealing Fire From The Gods"
 * 
 * @module      hack/workers/grow
 * @description Worker de grow - Augmente l'argent disponible sur un serveur cible.
 *              UtilisÃ© par le batcher pour les opÃ©rations HWGW (G = Grow).
 * @author      Claude (Anthropic) + tylersense-ui
 * @version     45.0 - PROMETHEUS
 * @date        2025-01-XX
 * @license     MIT
 * @requires    BitBurner v2.8.1+ (Steam)
 * @ram         1.75 GB (pour 1 thread)
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”¥ PROMETHEUS ENHANCEMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * âœ“ Validation complÃ¨te des arguments (target, delay)
 * âœ“ Try/catch robuste autour de ns.grow()
 * âœ“ Gestion d'erreur avec retry potentiel
 * âœ“ Logs dÃ©taillÃ©s avec icÃ´nes (ğŸ“ˆâœ…âŒâ±ï¸)
 * âœ“ Support du dÃ©lai de synchronisation HWGW
 * âœ“ Retour du multiplicateur de croissance pour mÃ©triques
 * âœ“ Protection contre arguments invalides
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * @usage
 *   ns.exec("/hack/workers/grow.js", "host", threads, "target", delay);
 * 
 * @arguments
 *   target (string)  - Hostname du serveur Ã  grow (requis)
 *   delay  (number)  - DÃ©lai en ms avant d'exÃ©cuter (dÃ©faut: 0)
 * 
 * @example
 *   // Grow immÃ©diat
 *   ns.exec("/hack/workers/grow.js", "pserv-0", 100, "n00dles", 0);
 * 
 * @example
 *   // Grow avec dÃ©lai (synchronisation HWGW)
 *   ns.exec("/hack/workers/grow.js", "pserv-0", 200, "joesguns", 8000);
 *   // Attend 8 secondes avant d'exÃ©cuter le grow
 * 
 * @returns
 *   Multiplicateur de croissance (number) si succÃ¨s, 1.0 si Ã©chec
 *   Exemple : 1.05 signifie que l'argent a augmentÃ© de 5%
 */

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ¯ WORKER GROW - MAIN FUNCTION
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ExÃ©cute une opÃ©ration de grow sur la cible aprÃ¨s un dÃ©lai optionnel.
 * 
 * Le grow augmente l'argent disponible sur le serveur cible.
 * Le multiplicateur dÃ©pend du niveau de hacking du joueur et de la sÃ©curitÃ© du serveur.
 * 
 * Augmente la sÃ©curitÃ© du serveur de 0.004 par thread (2x plus que hack).
 * 
 * @param {NS} ns - Namespace BitBurner
 */
export async function main(ns) {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“‹ VALIDATION DES ARGUMENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Argument 1 : target (requis)
    const target = ns.args[0];
    if (!target || typeof target !== 'string') {
        ns.tprint(`âŒ [GROW] Argument invalide: target doit Ãªtre un string (reÃ§u: ${target})`);
        return 1.0;
    }

    // VÃ©rifier que le serveur cible existe
    let serverExists = false;
    try {
        ns.getServer(target);
        serverExists = true;
    } catch (e) {
        ns.tprint(`âŒ [GROW] Serveur cible introuvable: ${target}`);
        return 1.0;
    }

    // Argument 2 : delay (optionnel, dÃ©faut 0)
    let delay = ns.args[1] || 0;
    if (typeof delay !== 'number' || delay < 0) {
        ns.print(`âš ï¸  [GROW] DÃ©lai invalide (${delay}), utilisation de 0`);
        delay = 0;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â±ï¸ DÃ‰LAI DE SYNCHRONISATION (si spÃ©cifiÃ©)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    if (delay > 0) {
        await ns.sleep(delay);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“ˆ EXÃ‰CUTION DU GROW
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const startTime = Date.now();
    let growthMultiplier = 1.0;

    try {
        // ns.grow() retourne le multiplicateur de croissance
        // Exemple : 1.05 = l'argent a augmentÃ© de 5%
        growthMultiplier = await ns.grow(target);
        
        const duration = Date.now() - startTime;
        
        if (growthMultiplier > 1.0) {
            // SuccÃ¨s - L'argent a augmentÃ©
            const percentGrowth = ((growthMultiplier - 1.0) * 100).toFixed(2);
            ns.print(`âœ… [GROW] ${target}: +${percentGrowth}% (x${growthMultiplier.toFixed(3)}, ${duration}ms)`);
        } else {
            // Pas de croissance (serveur dÃ©jÃ  au maximum ou erreur)
            ns.print(`âš ï¸  [GROW] ${target}: Aucune croissance (x${growthMultiplier.toFixed(3)}, ${duration}ms)`);
        }

    } catch (error) {
        // Erreur critique (serveur crashÃ©, script killÃ©, etc.)
        const duration = Date.now() - startTime;
        ns.tprint(`âŒ [GROW] Erreur critique sur ${target}: ${error.message} (${duration}ms)`);
        return 1.0;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š RETOUR DU RÃ‰SULTAT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Le multiplicateur est retournÃ© pour permettre au batcher de tracker les mÃ©triques
    return growthMultiplier;
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“š DOCUMENTATION TECHNIQUE
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * OPÃ‰RATION GROW :
 * ----------------
 * - Augmente l'argent disponible sur le serveur
 * - Le multiplicateur dÃ©pend de :
 *   â€¢ Niveau de hacking du joueur
 *   â€¢ SÃ©curitÃ© actuelle du serveur (plus haute = moins efficace)
 *   â€¢ Nombre de threads utilisÃ©s
 *   â€¢ Argent actuel vs argent maximum du serveur
 * 
 * - Augmente la sÃ©curitÃ© du serveur de 0.004 par thread
 *   (2x plus que hack, d'oÃ¹ le besoin de 2x plus de weaken aprÃ¨s grow)
 * 
 * - DurÃ©e de l'opÃ©ration :
 *   â€¢ ~3.2x plus longue que hack
 *   â€¢ Typiquement entre 3s et 15min
 *   â€¢ Calculable prÃ©cisÃ©ment avec ns.formulas.hacking.growTime()
 * 
 * MULTIPLICATEUR DE CROISSANCE :
 * -------------------------------
 * - Valeur retournÃ©e par ns.grow()
 * - Exemple : 1.05 signifie +5% d'argent
 * - Exemple : 2.0 signifie doublement de l'argent
 * 
 * - Plus le serveur est proche de moneyMax, plus le multiplicateur est faible
 * - Ã€ moneyMax, grow ne fait rien (multiplicateur = 1.0)
 * 
 * - Calculable Ã  l'avance avec ns.formulas.hacking.growPercent()
 * 
 * EFFICACITÃ‰ DU GROW :
 * --------------------
 * L'efficacitÃ© diminue quand le serveur est proche de moneyMax.
 * 
 * Exemple avec n00dles (moneyMax = $1.75m) :
 * - Ã€ $0       : 1 thread grow â†’ ~1.5x argent (trÃ¨s efficace)
 * - Ã€ $500k    : 1 thread grow â†’ ~1.1x argent (efficace)
 * - Ã€ $1.5m    : 1 thread grow â†’ ~1.01x argent (peu efficace)
 * - Ã€ $1.75m   : 1 thread grow â†’ 1.0x argent (aucun effet)
 * 
 * D'oÃ¹ l'importance de calculer le nombre exact de threads nÃ©cessaires
 * pour atteindre moneyMax sans gaspillage.
 * 
 * UTILISATION DANS HWGW :
 * -----------------------
 * Le grow est la troisiÃ¨me opÃ©ration du batch HWGW :
 * 1. HACK   - Vole l'argent (augmente sÃ©curitÃ© +0.002/thread)
 * 2. WEAKEN - RÃ©duit sÃ©curitÃ©
 * 3. GROW   - Augmente l'argent (augmente sÃ©curitÃ© +0.004/thread)
 * 4. WEAKEN - RÃ©duit sÃ©curitÃ©
 * 
 * Timing critique : Les 4 opÃ©rations doivent se terminer dans le bon ordre
 * avec un Ã©cart de ~200ms entre chaque.
 * 
 * Ordre de fin souhaitÃ© :
 * H finit Ã  T
 * W finit Ã  T + 200ms
 * G finit Ã  T + 400ms
 * W finit Ã  T + 600ms
 * 
 * CALCUL DU NOMBRE DE THREADS GROW :
 * -----------------------------------
 * Pour ramener un serveur de currentMoney Ã  moneyMax :
 * 
 * Sans Formulas.exe (approximation) :
 *   threadsNeeded = Math.ceil(ns.growthAnalyze(target, moneyMax / currentMoney))
 * 
 * Avec Formulas.exe (prÃ©cis) :
 *   multiplicateur = moneyMax / currentMoney
 *   threadsNeeded = calculÃ© itÃ©rativement avec ns.formulas.hacking.growPercent()
 * 
 * ATTENTION : Le grow est affectÃ© par la sÃ©curitÃ© du serveur.
 * Il faut toujours calculer les threads en tenant compte de la sÃ©curitÃ©
 * APRÃˆS le weaken qui le prÃ©cÃ¨de dans le batch.
 * 
 * ARGUMENTS DÃ‰TAILLÃ‰S :
 * ---------------------
 * target (string) :
 *   - Hostname du serveur Ã  grow
 *   - Doit exister et Ãªtre accessible
 *   - Le joueur doit avoir root access (vÃ©rifiÃ© par ns.grow)
 * 
 * delay (number, optionnel) :
 *   - DÃ©lai en millisecondes avant d'exÃ©cuter le grow
 *   - UtilisÃ© pour synchroniser les batchs HWGW
 *   - DÃ©faut : 0 (exÃ©cution immÃ©diate)
 *   - Exemple : delay = 8000 â†’ attend 8s avant de grow
 * 
 * CODES DE RETOUR :
 * -----------------
 * > 1.0 : Multiplicateur de croissance (succÃ¨s, argent augmentÃ©)
 * = 1.0 : Aucune croissance (serveur au max ou erreur)
 * 
 * En cas d'erreur critique (serveur introuvable, arguments invalides),
 * un message d'erreur est affichÃ© et 1.0 est retournÃ©.
 * 
 * EXEMPLES D'UTILISATION :
 * ------------------------
 * 
 * // Grow simple
 * ns.exec("/hack/workers/grow.js", "home", 1, "n00dles");
 * 
 * // Grow avec beaucoup de threads (ramener Ã  moneyMax)
 * const threadsNeeded = Math.ceil(ns.growthAnalyze("joesguns", 2.0));
 * ns.exec("/hack/workers/grow.js", "pserv-0", threadsNeeded, "joesguns");
 * 
 * // Grow synchronisÃ© (HWGW batch)
 * const growTime = ns.getGrowTime("joesguns");
 * const weakenTime = ns.getWeakenTime("joesguns");
 * const growDelay = weakenTime - growTime + 200; // Termine 200ms aprÃ¨s weaken1
 * ns.exec("/hack/workers/grow.js", "pserv-0", 200, "joesguns", growDelay);
 * 
 * PERFORMANCES :
 * --------------
 * RAM : 1.75 GB par thread (lÃ©gÃ¨rement plus que hack)
 * CPU : Faible (l'opÃ©ration est gÃ©rÃ©e par le jeu)
 * DurÃ©e : ~3.2x plus longue que hack
 * 
 * PROMETHEUS OPTIMISATIONS :
 * --------------------------
 * âœ“ Validation stricte des arguments (Ã©vite crashs)
 * âœ“ Try/catch autour de ns.grow() (gestion erreurs)
 * âœ“ Logs dÃ©taillÃ©s avec pourcentage de croissance
 * âœ“ Support du dÃ©lai pour synchronisation HWGW
 * âœ“ Retour du multiplicateur pour mÃ©triques du batcher
 * 
 * DIFFÃ‰RENCES AVEC HACK :
 * -----------------------
 * - DurÃ©e : ~3.2x plus longue
 * - RAM : 1.75 GB vs 1.70 GB (lÃ©gÃ¨rement plus)
 * - SÃ©curitÃ© : +0.004/thread vs +0.002/thread (2x plus)
 * - Retour : multiplicateur vs montant volÃ©
 * - Effet : augmente argent vs vole argent
 * 
 * TIPS POUR LE BATCHER :
 * ----------------------
 * 1. Toujours calculer les threads grow en fonction de l'argent actuel
 * 2. Prendre en compte la sÃ©curitÃ© du serveur aprÃ¨s weaken1
 * 3. Le grow est l'opÃ©ration la plus coÃ»teuse en threads (souvent 10-50x plus que hack)
 * 4. Ne pas grow un serveur dÃ©jÃ  Ã  moneyMax (gaspillage de RAM)
 * 5. Synchroniser avec prÃ©cision : grow doit finir 200ms aprÃ¨s weaken1
 */
