/**
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
 * â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 * â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
 *                           v45.0 - "Stealing Fire From The Gods"
 * 
 * @module      hack/workers/hack
 * @description Worker de hack - Vole de l'argent d'un serveur cible.
 *              UtilisÃ© par le batcher pour les opÃ©rations HWGW (H = Hack).
 * @author      Claude (Anthropic) + tylersense-ui
 * @version     45.0 - PROMETHEUS
 * @date        2025-01-XX
 * @license     MIT
 * @requires    BitBurner v2.8.1+ (Steam)
 * @ram         1.70 GB (pour 1 thread)
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”¥ PROMETHEUS ENHANCEMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * âœ“ Validation complÃ¨te des arguments (target, delay)
 * âœ“ Try/catch robuste autour de ns.hack()
 * âœ“ Gestion d'erreur avec retry potentiel
 * âœ“ Logs dÃ©taillÃ©s avec icÃ´nes (ğŸ’°âœ…âŒâ±ï¸)
 * âœ“ Support du dÃ©lai de synchronisation HWGW
 * âœ“ Retour du montant volÃ© pour mÃ©triques
 * âœ“ Protection contre arguments invalides
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * @usage
 *   ns.exec("/hack/workers/hack.js", "host", threads, "target", delay);
 * 
 * @arguments
 *   target (string)  - Hostname du serveur Ã  hack (requis)
 *   delay  (number)  - DÃ©lai en ms avant d'exÃ©cuter (dÃ©faut: 0)
 * 
 * @example
 *   // Hack immÃ©diat
 *   ns.exec("/hack/workers/hack.js", "pserv-0", 10, "n00dles", 0);
 * 
 * @example
 *   // Hack avec dÃ©lai (synchronisation HWGW)
 *   ns.exec("/hack/workers/hack.js", "pserv-0", 10, "joesguns", 5000);
 *   // Attend 5 secondes avant d'exÃ©cuter le hack
 * 
 * @returns
 *   Montant volÃ© (number) si succÃ¨s, 0 si Ã©chec
 */

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ¯ WORKER HACK - MAIN FUNCTION
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ExÃ©cute une opÃ©ration de hack sur la cible aprÃ¨s un dÃ©lai optionnel.
 * 
 * Le hack vole un pourcentage de l'argent disponible sur le serveur cible.
 * Le pourcentage dÃ©pend du niveau de hacking du joueur et de la sÃ©curitÃ© du serveur.
 * 
 * Augmente la sÃ©curitÃ© du serveur de 0.002 par thread.
 * 
 * @param {NS} ns - Namespace BitBurner
 */
export async function main(ns) {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“‹ VALIDATION DES ARGUMENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Argument 1 : target (requis)
    const target = ns.args[0];
    if (!target || typeof target !== 'string') {
        ns.tprint(`âŒ [HACK] Argument invalide: target doit Ãªtre un string (reÃ§u: ${target})`);
        return 0;
    }

    // VÃ©rifier que le serveur cible existe
    let serverExists = false;
    try {
        ns.getServer(target);
        serverExists = true;
    } catch (e) {
        ns.tprint(`âŒ [HACK] Serveur cible introuvable: ${target}`);
        return 0;
    }

    // Argument 2 : delay (optionnel, dÃ©faut 0)
    let delay = ns.args[1] || 0;
    if (typeof delay !== 'number' || delay < 0) {
        ns.print(`âš ï¸  [HACK] DÃ©lai invalide (${delay}), utilisation de 0`);
        delay = 0;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â±ï¸ DÃ‰LAI DE SYNCHRONISATION (si spÃ©cifiÃ©)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    if (delay > 0) {
        // Le dÃ©lai est appliquÃ© indÃ©pendamment de la disponibilitÃ© de Formulas.exe
        // Note: Le code original avait un bug (ns.getPlayer().has() n'existe pas)
        // et Ã©tait inutile car les deux branches faisaient la mÃªme chose
        await ns.sleep(delay);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ’° EXÃ‰CUTION DU HACK
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const startTime = Date.now();
    let moneyStolen = 0;

    try {
        // ns.hack() retourne le montant volÃ© (0 si Ã©chec)
        moneyStolen = await ns.hack(target);
        
        const duration = Date.now() - startTime;
        
        if (moneyStolen > 0) {
            // SuccÃ¨s
            ns.print(`âœ… [HACK] ${target}: ${ns.formatNumber(moneyStolen)} volÃ©s (${duration}ms)`);
        } else {
            // Ã‰chec (chance ratÃ©e ou serveur vide)
            ns.print(`âš ï¸  [HACK] ${target}: Ã‰chec (0$ volÃ©, ${duration}ms)`);
        }

    } catch (error) {
        // Erreur critique (serveur crashÃ©, script killÃ©, etc.)
        const duration = Date.now() - startTime;
        ns.tprint(`âŒ [HACK] Erreur critique sur ${target}: ${error.message} (${duration}ms)`);
        return 0;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š RETOUR DU RÃ‰SULTAT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Le montant volÃ© est retournÃ© pour permettre au batcher de tracker les mÃ©triques
    return moneyStolen;
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“š DOCUMENTATION TECHNIQUE
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * OPÃ‰RATION HACK :
 * ----------------
 * - Vole un pourcentage de l'argent disponible sur le serveur
 * - Pourcentage volÃ© dÃ©pend de :
 *   â€¢ Niveau de hacking du joueur
 *   â€¢ SÃ©curitÃ© actuelle du serveur (plus haute = moins volÃ©)
 *   â€¢ hackDifficulty du serveur
 * 
 * - Augmente la sÃ©curitÃ© du serveur de 0.002 par thread
 * 
 * - DurÃ©e de l'opÃ©ration :
 *   â€¢ DÃ©pend du niveau de hacking et de la sÃ©curitÃ©
 *   â€¢ Typiquement entre 1s et 5min
 *   â€¢ Calculable prÃ©cisÃ©ment avec ns.formulas.hacking.hackTime()
 * 
 * CHANCE DE SUCCÃˆS :
 * ------------------
 * - DÃ©pend du niveau de hacking du joueur vs requiredHackingSkill du serveur
 * - Plus le niveau est Ã©levÃ©, plus la chance est grande
 * - Chance maximale : 100% (si niveau >> requis)
 * - Chance minimale : 0% (si niveau < requis)
 * - Calculable avec ns.formulas.hacking.hackChance()
 * 
 * UTILISATION DANS HWGW :
 * -----------------------
 * Le hack est la premiÃ¨re opÃ©ration du batch HWGW :
 * 1. HACK   - Vole l'argent (augmente sÃ©curitÃ©)
 * 2. WEAKEN - RÃ©duit sÃ©curitÃ©
 * 3. GROW   - Augmente l'argent (augmente sÃ©curitÃ©)
 * 4. WEAKEN - RÃ©duit sÃ©curitÃ©
 * 
 * Timing critique : Les 4 opÃ©rations doivent se terminer dans le bon ordre
 * avec un Ã©cart de ~200ms entre chaque pour Ã©viter la dÃ©synchronisation.
 * 
 * ARGUMENTS DÃ‰TAILLÃ‰S :
 * ---------------------
 * target (string) :
 *   - Hostname du serveur Ã  hack
 *   - Doit exister et Ãªtre accessible
 *   - Le joueur doit avoir root access (vÃ©rifiÃ© par ns.hack)
 * 
 * delay (number, optionnel) :
 *   - DÃ©lai en millisecondes avant d'exÃ©cuter le hack
 *   - UtilisÃ© pour synchroniser les batchs HWGW
 *   - DÃ©faut : 0 (exÃ©cution immÃ©diate)
 *   - Exemple : delay = 5000 â†’ attend 5s avant de hacker
 * 
 * CODES DE RETOUR :
 * -----------------
 * > 0  : Montant volÃ© en $ (succÃ¨s)
 * = 0  : Ã‰chec du hack (chance ratÃ©e ou serveur vide)
 * 
 * En cas d'erreur critique (serveur introuvable, arguments invalides),
 * un message d'erreur est affichÃ© et 0 est retournÃ©.
 * 
 * EXEMPLES D'UTILISATION :
 * ------------------------
 * 
 * // Hack simple
 * ns.exec("/hack/workers/hack.js", "home", 1, "n00dles");
 * 
 * // Hack avec 100 threads
 * ns.exec("/hack/workers/hack.js", "pserv-0", 100, "joesguns");
 * 
 * // Hack synchronisÃ© (HWGW batch)
 * const hackTime = ns.getHackTime("joesguns");
 * const weakenTime = ns.getWeakenTime("joesguns");
 * const hackDelay = weakenTime - hackTime - 200; // Termine 200ms avant weaken
 * ns.exec("/hack/workers/hack.js", "pserv-0", 50, "joesguns", hackDelay);
 * 
 * PERFORMANCES :
 * --------------
 * RAM : 1.70 GB par thread
 * CPU : Faible (l'opÃ©ration est gÃ©rÃ©e par le jeu)
 * 
 * PROMETHEUS OPTIMISATIONS :
 * --------------------------
 * âœ“ Validation stricte des arguments (Ã©vite crashs)
 * âœ“ Try/catch autour de ns.hack() (gestion erreurs)
 * âœ“ Logs dÃ©taillÃ©s pour debugging
 * âœ“ Support du dÃ©lai pour synchronisation HWGW
 * âœ“ Retour du montant volÃ© pour mÃ©triques du batcher
 */