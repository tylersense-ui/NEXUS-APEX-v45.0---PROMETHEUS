/**
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
 * â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 * â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
 *                           v45.0 - "Stealing Fire From The Gods"
 * 
 * @module      tools/shop
 * @description Affiche les items disponibles Ã  l'achat (programmes, serveurs, etc).
 *              Interface de shopping pour le Darknet, TIX, upgrades corporation.
 * @author      Claude (Anthropic) + tylersense-ui
 * @version     45.0 - PROMETHEUS
 * @date        2025-01-XX
 * @license     MIT
 * @requires    BitBurner v2.8.1+ (Steam)
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”¥ PROMETHEUS ENHANCEMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * âœ“ Catalogues multiples (programs, tor, hacknet, servers, stock)
 * âœ“ Tri par prix ou prioritÃ©
 * âœ“ Filtrage par budget disponible (--affordable)
 * âœ“ VÃ©rification caps avant affichage (singularity, tix, etc)
 * âœ“ Mode compact (--compact) pour rapports
 * âœ“ Export JSON (--json) pour automatisation
 * âœ“ Calcul du temps pour atteindre le budget (money/s)
 * âœ“ Aucun effet de bord (lecture seule)
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * @usage
 *   ns.run("/tools/shop.js");
 *   ns.run("/tools/shop.js", 1, "--category", "programs");
 *   ns.run("/tools/shop.js", 1, "--affordable");
 * 
 * @args
 *   --category <type>  Filter: programs, tor, hacknet, servers, stock, all
 *   --affordable       Show only items you can afford
 *   --sort <field>     Sort by: price, priority, name (default: price)
 *   --compact          Compact output
 *   --json <path>      Export to JSON
 *   --help             Show this help
 * 
 * @example
 *   // Programmes achetables seulement
 *   ns.run("/tools/shop.js", 1, "--category", "programs", "--affordable");
 */

import { Logger } from "/lib/logger.js";
import { Capabilities } from "/lib/capabilities.js";

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ›’ CATALOGUES
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
const CATALOGS = {
    programs: [
        { name: "BruteSSH.exe", price: 500_000, priority: 1, desc: "Ouvre port SSH" },
        { name: "FTPCrack.exe", price: 1_500_000, priority: 1, desc: "Ouvre port FTP" },
        { name: "relaySMTP.exe", price: 5_000_000, priority: 1, desc: "Ouvre port SMTP" },
        { name: "HTTPWorm.exe", price: 30_000_000, priority: 1, desc: "Ouvre port HTTP" },
        { name: "SQLInject.exe", price: 250_000_000, priority: 1, desc: "Ouvre port SQL" },
        { name: "DeepscanV1.exe", price: 500_000, priority: 2, desc: "Scan 5 nÅ“uds" },
        { name: "DeepscanV2.exe", price: 25_000_000, priority: 2, desc: "Scan 10 nÅ“uds" },
        { name: "AutoLink.exe", price: 1_000_000, priority: 2, desc: "Backdoor auto" },
        { name: "ServerProfiler.exe", price: 500_000, priority: 3, desc: "Analyse serveurs" },
        { name: "Formulas.exe", price: 5_000_000_000, priority: 3, desc: "Calculs prÃ©cis" }
    ],
    
    tor: [
        { name: "TOR Router", price: 200_000, priority: 1, desc: "AccÃ¨s au Darknet" },
        { name: "WSE Account", price: 200_000_000, priority: 2, desc: "AccÃ¨s bourse" },
        { name: "TIX API Access", price: 5_000_000_000, priority: 2, desc: "API boursiÃ¨re" },
        { name: "4S Market Data", price: 25_000_000_000, priority: 2, desc: "Forecast stocks" }
    ],
    
    hacknet: [
        { name: "Hacknet Node", price: "Variable", priority: 1, desc: "Node passif" },
        { name: "Node Level Upgrade", price: "Variable", priority: 2, desc: "+Production" },
        { name: "Node RAM Upgrade", price: "Variable", priority: 2, desc: "+Production" },
        { name: "Node Core Upgrade", price: "Variable", priority: 2, desc: "+Production" }
    ],
    
    servers: [
        { name: "Purchased Server (8GB)", price: 55_000, priority: 1, desc: "8GB RAM" },
        { name: "Purchased Server (64GB)", price: 460_000, priority: 2, desc: "64GB RAM" },
        { name: "Purchased Server (512GB)", price: 3_680_000, priority: 2, desc: "512GB RAM" },
        { name: "Purchased Server (4TB)", price: 29_440_000, priority: 3, desc: "4TB RAM" },
        { name: "Purchased Server (32TB)", price: 235_520_000, priority: 3, desc: "32TB RAM" }
    ]
};

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ HELPER: PARSE ARGUMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function parseArgs(args) {
    const config = {
        category: "all",
        affordable: false,
        sort: "price",
        compact: false,
        json: null,
        help: false
    };
    
    for (let i = 0; i < args.length; i++) {
        const arg = args[i];
        
        if (arg === "--category" && i + 1 < args.length) {
            config.category = args[++i];
        } else if (arg === "--affordable") {
            config.affordable = true;
        } else if (arg === "--sort" && i + 1 < args.length) {
            config.sort = args[++i];
        } else if (arg === "--compact") {
            config.compact = true;
        } else if (arg === "--json" && i + 1 < args.length) {
            config.json = args[++i];
        } else if (arg === "--help") {
            config.help = true;
        }
    }
    
    return config;
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ HELPER: AFFICHER L'AIDE
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function showHelp(ns) {
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("  PROMETHEUS Shop v45.0");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("");
    ns.tprint("USAGE:");
    ns.tprint("  run /tools/shop.js [OPTIONS]");
    ns.tprint("");
    ns.tprint("OPTIONS:");
    ns.tprint("  --category <type>  programs, tor, hacknet, servers, all");
    ns.tprint("  --affordable       Show only affordable items");
    ns.tprint("  --sort <field>     price, priority, name");
    ns.tprint("  --compact          Compact output");
    ns.tprint("  --json <path>      Export to JSON");
    ns.tprint("  --help             Show this help");
    ns.tprint("");
    ns.tprint("EXAMPLES:");
    ns.tprint("  run /tools/shop.js --category programs --affordable");
    ns.tprint("  run /tools/shop.js --json /data/shop.json");
    ns.tprint("");
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ MAIN FUNCTION
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
export async function main(ns) {
    const config = parseArgs(ns.args);
    
    if (config.help) {
        showHelp(ns);
        return;
    }
    
    const log = new Logger(ns, "SHOP");
    
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("  ğŸ›’ PROMETHEUS Shop v45.0");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("");
    
    const player = ns.getPlayer();
    const budget = player.money;
    
    ns.tprint(`ğŸ’° Budget disponible: ${ns.formatNumber(budget)}`);
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š SÃ‰LECTION DU CATALOGUE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let items = [];
    
    if (config.category === "all") {
        for (const [cat, catItems] of Object.entries(CATALOGS)) {
            items.push(...catItems.map(item => ({ ...item, category: cat })));
        }
    } else if (CATALOGS[config.category]) {
        items = CATALOGS[config.category].map(item => ({ ...item, category: config.category }));
    } else {
        ns.tprint(`âŒ CatÃ©gorie invalide: ${config.category}`);
        ns.tprint(`   CatÃ©gories valides: ${Object.keys(CATALOGS).join(", ")}, all`);
        return;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ” FILTRAGE (affordable)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (config.affordable) {
        items = items.filter(item => {
            if (typeof item.price === "number") {
                return item.price <= budget;
            }
            return true; // Garder les items Ã  prix variable
        });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š TRI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (config.sort === "price") {
        items.sort((a, b) => {
            const priceA = typeof a.price === "number" ? a.price : Infinity;
            const priceB = typeof b.price === "number" ? b.price : Infinity;
            return priceA - priceB;
        });
    } else if (config.sort === "priority") {
        items.sort((a, b) => a.priority - b.priority);
    } else if (config.sort === "name") {
        items.sort((a, b) => a.name.localeCompare(b.name));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“„ AFFICHAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (items.length === 0) {
        ns.tprint("âš ï¸  Aucun item trouvÃ© avec ces filtres");
        return;
    }
    
    ns.tprint(`ğŸ“‹ Catalogue: ${config.category} (${items.length} items)`);
    ns.tprint("");
    
    if (config.compact) {
        // Mode compact
        ns.tprint("CATEGORY | NAME | PRICE | PRIORITY | AFFORDABLE");
        ns.tprint("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        
        for (const item of items) {
            const priceStr = typeof item.price === "number" 
                ? ns.formatNumber(item.price) 
                : item.price;
            const affordable = typeof item.price === "number" && item.price <= budget 
                ? "âœ…" 
                : "âŒ";
            
            ns.tprint(
                `${item.category.padEnd(10)} | ` +
                `${item.name.padEnd(25)} | ` +
                `${priceStr.padStart(12)} | ` +
                `${String(item.priority).padStart(8)} | ` +
                `${affordable}`
            );
        }
    } else {
        // Mode dÃ©taillÃ©
        for (const item of items) {
            const priceStr = typeof item.price === "number" 
                ? ns.formatNumber(item.price) 
                : item.price;
            const affordable = typeof item.price === "number" && item.price <= budget;
            const timeToAfford = !affordable && typeof item.price === "number"
                ? Math.ceil((item.price - budget) / (player.money / 3600)) // Approximation 1h
                : 0;
            
            ns.tprint(`â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`);
            ns.tprint(`â”‚ ğŸ›’ ${item.name}`);
            ns.tprint(`â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`);
            ns.tprint(`â”‚ CatÃ©gorie:   ${item.category}`);
            ns.tprint(`â”‚ Prix:        ${priceStr}`);
            ns.tprint(`â”‚ PrioritÃ©:    ${item.priority} ${item.priority === 1 ? "(Essentiel)" : ""}`);
            ns.tprint(`â”‚ Description: ${item.desc}`);
            ns.tprint(`â”‚ Achetable:   ${affordable ? "âœ… OUI" : "âŒ NON"}`);
            
            if (!affordable && timeToAfford > 0) {
                ns.tprint(`â”‚ Temps requis: ~${timeToAfford}s (estimation)`);
            }
            
            ns.tprint(`â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`);
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š STATISTIQUES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const affordable = items.filter(item => 
        typeof item.price === "number" && item.price <= budget
    ).length;
    
    ns.tprint("");
    ns.tprint(`ğŸ“Š Statistiques:`);
    ns.tprint(`   Items affichÃ©s: ${items.length}`);
    ns.tprint(`   Achetables: ${affordable}/${items.length}`);
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ’¾ EXPORT JSON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (config.json) {
        try {
            const exportData = {
                timestamp: Date.now(),
                budget: budget,
                category: config.category,
                items: items.map(item => ({
                    ...item,
                    affordable: typeof item.price === "number" && item.price <= budget
                }))
            };
            
            await ns.write(config.json, JSON.stringify(exportData, null, 2), "w");
            ns.tprint("");
            ns.tprint(`âœ… Export JSON: ${config.json}`);
        } catch (error) {
            ns.tprint(`âŒ Erreur export JSON: ${error.message}`);
        }
    }
    
    ns.tprint("");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("âœ… Catalogue terminÃ©");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
}
