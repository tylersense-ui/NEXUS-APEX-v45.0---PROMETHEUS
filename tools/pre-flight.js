/**
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
 * â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 * â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
 *                           v45.0 - "Stealing Fire From The Gods"
 * 
 * @module      tools/pre-flight
 * @description VÃ©rifications prÃ©-dÃ©marrage du systÃ¨me Nexus-Automation.
 *              Valide l'intÃ©gritÃ© des fichiers, configs et dÃ©pendances.
 * @author      Claude (Anthropic) + tylersense-ui
 * @version     45.0 - PROMETHEUS
 * @date        2025-01-XX
 * @license     MIT
 * @requires    BitBurner v2.8.1+ (Steam)
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”¥ PROMETHEUS ENHANCEMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * âœ“ Validation de l'existence de TOUS les fichiers core/lib/hack
 * âœ“ VÃ©rification de l'intÃ©gritÃ© de constants.js (JSON valide)
 * âœ“ Test des capacitÃ©s du joueur (SF unlocks)
 * âœ“ VÃ©rification de la RAM disponible sur home
 * âœ“ Test de lecture/Ã©criture des ports
 * âœ“ Validation des dÃ©pendances externes (formulas, singularity)
 * âœ“ Rapport dÃ©taillÃ© avec warnings et blockers
 * âœ“ Exit code appropriÃ© (0 = OK, 1 = warnings, 2 = blockers)
 * âœ“ Mode verbose (--verbose) pour diagnostics
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * @usage
 *   ns.run("/tools/pre-flight.js");
 *   ns.run("/tools/pre-flight.js", 1, "--verbose");
 * 
 * @args
 *   --verbose          Afficher les dÃ©tails de chaque vÃ©rification
 *   --json <path>      Export rÃ©sultat en JSON
 *   --help             Show this help
 * 
 * @example
 *   // Avant de lancer boot.js
 *   ns.run("/tools/pre-flight.js");
 *   // Si OK â†’ ns.run("/boot.js");
 */

import { Logger } from "/lib/logger.js";
import { Capabilities } from "/lib/capabilities.js";

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“‹ FICHIERS REQUIS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
const REQUIRED_FILES = {
    core: [
        "/core/batcher.js",
        "/core/dashboard.js",
        "/core/orchestrator.js",
        "/core/port-handler.js",
        "/core/ram-manager.js"
    ],
    lib: [
        "/lib/capabilities.js",
        "/lib/constants.js",
        "/lib/logger.js",
        "/lib/network.js"
    ],
    hack: [
        "/hack/controller.js",
        "/hack/watcher.js",
        "/hack/workers/hack.js",
        "/hack/workers/grow.js",
        "/hack/workers/weaken.js",
        "/hack/workers/share.js"
    ],
    root: [
        "/boot.js",
        "/global-kill.js"
    ]
};

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ HELPER: PARSE ARGUMENTS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function parseArgs(args) {
    const config = {
        verbose: false,
        json: null,
        help: false
    };
    
    for (let i = 0; i < args.length; i++) {
        const arg = args[i];
        
        if (arg === "--verbose") {
            config.verbose = true;
        } else if (arg === "--json" && i + 1 < args.length) {
            config.json = args[++i];
        } else if (arg === "--help") {
            config.help = true;
        }
    }
    
    return config;
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ HELPER: AFFICHER L'AIDE
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function showHelp(ns) {
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("  PROMETHEUS Pre-Flight Check v45.0");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("");
    ns.tprint("USAGE:");
    ns.tprint("  run /tools/pre-flight.js [OPTIONS]");
    ns.tprint("");
    ns.tprint("OPTIONS:");
    ns.tprint("  --verbose          Show detailed check results");
    ns.tprint("  --json <path>      Export results to JSON");
    ns.tprint("  --help             Show this help");
    ns.tprint("");
    ns.tprint("EXIT CODES:");
    ns.tprint("  0 = All checks passed");
    ns.tprint("  1 = Warnings detected (non-critical)");
    ns.tprint("  2 = Blockers detected (critical failures)");
    ns.tprint("");
}

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ”§ MAIN FUNCTION
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
export async function main(ns) {
    const config = parseArgs(ns.args);
    
    if (config.help) {
        showHelp(ns);
        return;
    }
    
    const log = new Logger(ns, "PRE-FLIGHT");
    
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("  âœˆï¸  PROMETHEUS Pre-Flight Check v45.0");
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š RÃ‰SULTATS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const results = {
        timestamp: Date.now(),
        checks: [],
        warnings: [],
        blockers: [],
        passed: 0,
        failed: 0
    };
    
    /**
     * Helper pour ajouter un check
     */
    function addCheck(name, status, message, level = "info") {
        const check = { name, status, message, level };
        results.checks.push(check);
        
        if (status === "PASS") {
            results.passed++;
            if (config.verbose) {
                ns.tprint(`âœ… ${name}: ${message}`);
            }
        } else if (status === "FAIL") {
            results.failed++;
            
            if (level === "blocker") {
                results.blockers.push(check);
                ns.tprint(`âŒ BLOCKER: ${name}`);
                ns.tprint(`   ${message}`);
            } else {
                results.warnings.push(check);
                ns.tprint(`âš ï¸  WARNING: ${name}`);
                ns.tprint(`   ${message}`);
            }
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“ CHECK 1: FICHIERS REQUIS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("ğŸ“ VÃ©rification des fichiers...");
    
    let missingFiles = [];
    
    for (const [category, files] of Object.entries(REQUIRED_FILES)) {
        for (const file of files) {
            if (ns.fileExists(file, "home")) {
                addCheck(`File: ${file}`, "PASS", "Exists");
            } else {
                missingFiles.push(file);
                addCheck(`File: ${file}`, "FAIL", "File not found", "blocker");
            }
        }
    }
    
    if (missingFiles.length === 0) {
        ns.tprint(`   âœ… Tous les fichiers requis prÃ©sents (${results.passed} fichiers)`);
    } else {
        ns.tprint(`   âŒ ${missingFiles.length} fichiers manquants`);
    }
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âš™ï¸  CHECK 2: CONSTANTS.JS (JSON valide)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("âš™ï¸  VÃ©rification de constants.js...");
    
    try {
        const { CONFIG } = await import("/lib/constants.js");
        
        if (CONFIG && typeof CONFIG === "object") {
            addCheck("constants.js", "PASS", "Valid configuration object");
            ns.tprint(`   âœ… Configuration valide`);
            
            // VÃ©rifier les sections importantes
            const requiredSections = ["SYSTEM", "HACKING", "PORTS"];
            for (const section of requiredSections) {
                if (CONFIG[section]) {
                    addCheck(`CONFIG.${section}`, "PASS", "Section exists");
                } else {
                    addCheck(`CONFIG.${section}`, "FAIL", "Section missing", "warning");
                }
            }
        } else {
            addCheck("constants.js", "FAIL", "Invalid CONFIG export", "blocker");
            ns.tprint(`   âŒ Configuration invalide`);
        }
    } catch (error) {
        addCheck("constants.js", "FAIL", `Import failed: ${error.message}`, "blocker");
        ns.tprint(`   âŒ Erreur import: ${error.message}`);
    }
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¯ CHECK 3: CAPACITÃ‰S DU JOUEUR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("ğŸ¯ VÃ©rification des capacitÃ©s...");
    
    try {
        const caps = new Capabilities(ns);
        
        addCheck("Capabilities", "PASS", "Object created successfully");
        
        // Tester les principales capacitÃ©s
        const capTests = [
            { name: "formulas", value: caps.formulas },
            { name: "singularity", value: caps.singularity },
            { name: "tix", value: caps.tix },
            { name: "has4S", value: caps.has4S },
            { name: "gang", value: caps.gang },
            { name: "sleeve", value: caps.sleeve },
            { name: "corp", value: caps.corp }
        ];
        
        for (const test of capTests) {
            if (test.value) {
                addCheck(`Capability: ${test.name}`, "PASS", "Available");
                if (config.verbose) {
                    ns.tprint(`   âœ… ${test.name} disponible`);
                }
            } else {
                addCheck(`Capability: ${test.name}`, "FAIL", "Not available", "info");
            }
        }
        
        ns.tprint(`   â„¹ï¸  CapacitÃ©s dÃ©tectÃ©es: ${capTests.filter(t => t.value).length}/${capTests.length}`);
        
    } catch (error) {
        addCheck("Capabilities", "FAIL", `Test failed: ${error.message}`, "warning");
        ns.tprint(`   âš ï¸  Erreur test capacitÃ©s: ${error.message}`);
    }
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ’¾ CHECK 4: RAM DISPONIBLE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("ğŸ’¾ VÃ©rification de la RAM...");
    
    const homeMaxRAM = ns.getServerMaxRam("home");
    const homeUsedRAM = ns.getServerUsedRam("home");
    const homeFreeRAM = homeMaxRAM - homeUsedRAM;
    
    addCheck("Home RAM", "PASS", `${ns.formatRam(homeMaxRAM)} total`);
    
    if (homeFreeRAM < 32) {
        addCheck("Home Free RAM", "FAIL", `Only ${ns.formatRam(homeFreeRAM)} free`, "warning");
        ns.tprint(`   âš ï¸  RAM libre faible: ${ns.formatRam(homeFreeRAM)}`);
    } else {
        addCheck("Home Free RAM", "PASS", `${ns.formatRam(homeFreeRAM)} available`);
        ns.tprint(`   âœ… RAM libre: ${ns.formatRam(homeFreeRAM)}`);
    }
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ”Œ CHECK 5: PORTS (test lecture/Ã©criture)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("ğŸ”Œ VÃ©rification des ports...");
    
    try {
        const testPort = 20; // Port 20 pour test
        const testData = { test: true, timestamp: Date.now() };
        
        // Test Ã©criture
        ns.clearPort(testPort);
        ns.writePort(testPort, JSON.stringify(testData));
        
        // Test lecture
        const readData = ns.readPort(testPort);
        const parsed = JSON.parse(readData);
        
        if (parsed.test === true) {
            addCheck("Port I/O", "PASS", "Read/write successful");
            ns.tprint(`   âœ… Lecture/Ã©criture des ports OK`);
        } else {
            addCheck("Port I/O", "FAIL", "Data mismatch", "warning");
            ns.tprint(`   âš ï¸  DonnÃ©es port corrompues`);
        }
        
        // Nettoyer
        ns.clearPort(testPort);
        
    } catch (error) {
        addCheck("Port I/O", "FAIL", `Test failed: ${error.message}`, "warning");
        ns.tprint(`   âš ï¸  Erreur test ports: ${error.message}`);
    }
    ns.tprint("");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š RÃ‰SUMÃ‰ FINAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    ns.tprint("ğŸ“Š RÃ©sumÃ© Pre-Flight:");
    ns.tprint(`   Checks totaux: ${results.checks.length}`);
    ns.tprint(`   Passed: ${results.passed}`);
    ns.tprint(`   Failed: ${results.failed}`);
    ns.tprint(`   Warnings: ${results.warnings.length}`);
    ns.tprint(`   Blockers: ${results.blockers.length}`);
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¯ VERDICT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let exitCode = 0;
    
    if (results.blockers.length > 0) {
        ns.tprint("");
        ns.tprint("âŒ CRITICAL: Blockers dÃ©tectÃ©s - SystÃ¨me non opÃ©rationnel");
        ns.tprint("   RÃ©solvez les erreurs critiques avant de lancer boot.js");
        exitCode = 2;
    } else if (results.warnings.length > 0) {
        ns.tprint("");
        ns.tprint("âš ï¸  WARNING: Avertissements dÃ©tectÃ©s");
        ns.tprint("   Le systÃ¨me peut fonctionner mais avec limitations");
        exitCode = 1;
    } else {
        ns.tprint("");
        ns.tprint("âœ… ALL SYSTEMS GO - PrÃªt pour le lancement");
        ns.tprint("   Vous pouvez exÃ©cuter: run /boot.js");
        exitCode = 0;
    }
    
    ns.tprint("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ’¾ EXPORT JSON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (config.json) {
        try {
            await ns.write(config.json, JSON.stringify(results, null, 2), "w");
            ns.tprint("");
            ns.tprint(`âœ… Export JSON: ${config.json}`);
        } catch (error) {
            ns.tprint(`âŒ Erreur export JSON: ${error.message}`);
        }
    }
    
    // Note: BitBurner ne supporte pas process.exit(), donc on utilise juste return
    // mais le exitCode est disponible pour les scripts qui appellent celui-ci
    results.exitCode = exitCode;
}
